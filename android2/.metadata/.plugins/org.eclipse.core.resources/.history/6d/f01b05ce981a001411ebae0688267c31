package com.example.hal;

import java.lang.reflect.Method;

import android.app.Activity;
import android.app.admin.DeviceAdminReceiver;
import android.app.admin.DevicePolicyManager;
import android.bluetooth.BluetoothAdapter;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.net.NetworkInfo.State;
import android.net.wifi.WifiManager;
import android.widget.Toast;

public class control_tower extends Activity {

	// http://is.gd/eyUGgH
	public static class DeviceAdminClass extends DeviceAdminReceiver {
		void showToast(Context context, String msg) {
			Toast.makeText(context, msg, Toast.LENGTH_SHORT).show();
		}

		@Override
		public void onEnabled(Context context, Intent intent) {
			showToast(context, "Device Admin Permission Enabled");
		}

		@Override
		public CharSequence onDisableRequested(Context context, Intent intent) {
			return "Device Disabling Request";
		}

		@Override
		public void onDisabled(Context context, Intent intent) {
			showToast(context, "Device Admin Permission Disabled");
		}
	}

	boolean camera 		= false;
	boolean microphone 	= false;
	boolean sdcard 		= false;
	boolean gps 		= false;
	boolean mobile 		= false;
	boolean wifi 		= false;
	boolean bluetooth 	= false;

	public int get_status(Context context, String name) {

		if (name=="camera") {

		}

		if (name=="microphone") {

		}

		if (name=="sdcard") {

		}

		if (name=="gps") {

		}

		if (name=="mobile") {
			return ismobile(context);
		}

		if (name=="wifi") {
			return iswifi(context);
		}

		if (name=="bth") {

		}

		return -1;
	}

	public int control(Context context, String name, boolean bool) {

		toast_print(context, name + " / " + bool);

		if (name=="camera") {
			if (0 <= toggleCamera(context, bool)) {
				camera = bool;
				toast_print(context, "ch camera");
			} else
				toast_print(context, "Camera toggle fail..!");
		}

		if (name=="microphone") {
			if (0 <= toggleMicrophone(context, bool))
				microphone = bool;
			else
				toast_print(context, "microphone toggle fail..!");
		}

		if (name=="sdcard") {
			if (0 <= toggleSdcard(context, bool))
				sdcard = bool;
			else
				toast_print(context, "sdcard toggle fail..!");
		}

		if (name=="gps") {
			if (0 <= toggleGps(context, bool))
				gps = bool;
			else
				toast_print(context, "gps toggle fail..!");
		}

		if (name=="mobile") {
			try {
				if (0 <= toggleMobile(context, bool))
					mobile = bool;
				else
					toast_print(context, "mobile toggle fail..!");
			} catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}

		if (name=="wifi") {
			if (0 <= toggleWiFi(context, bool))
				wifi = bool;
			else
				toast_print(context, "wifi toggle fail..!");
		}

		if (name=="bluetooth") {
			if (0 <= togglebluetooth(context, bool))
				bluetooth = bool;
			else
				toast_print(context, "bluetooth toggle fail..!");
		}

		return 0;
	}

	public boolean get_status(){

		return false;
	}

	public int update_status(){

		camera 		= false;
		microphone 	= false;
		sdcard 		= false;
		gps 		= false;
		mobile 		= false;
		wifi 		= false;
		bluetooth 	= false;

		return 0;
	}

	/* Camera */
	private int toggleCamera(Context context, boolean status) {

		try {
			ComponentName adminComponent = new ComponentName(getBaseContext(), DeviceAdminClass.class);
			DevicePolicyManager devicePolicyManager = (DevicePolicyManager)getSystemService(Context.DEVICE_POLICY_SERVICE);
			
			if(!devicePolicyManager.isAdminActive(adminComponent)) {
				Intent intent = new Intent(DevicePolicyManager.ACTION_ADD_DEVICE_ADMIN);

				intent.putExtra(DevicePolicyManager.EXTRA_DEVICE_ADMIN, adminComponent);
				intent.putExtra(DevicePolicyManager.EXTRA_ADD_EXPLANATION, "Must using this App, Need this permission");

				// TODO: 이 기기관리자 액티비티에서 "활성화"를 누르면 메인 엑티비티를 보여주고,
				// "취소"를 누르면 앱이 종료되도록 할것.
				startActivityForResult(intent, 1);
			}
			devicePolicyManager.setCameraDisabled(adminComponent, status);

			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* Microphone */
	private int toggleMicrophone(Context context, boolean status) {

		try {
			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* Sdcard */
	private int toggleSdcard(Context context, boolean status) {

		try {
			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* Gps */
	private int toggleGps(Context context, boolean status) {

		try {
			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* Mobile */
	private int toggleMobile(Context context, boolean on) {
		try {
			ConnectivityManager connectivityManager = (ConnectivityManager)context.getSystemService("connectivity");

			Method method = connectivityManager.getClass().getMethod("setMobileDataEnabled", boolean.class);
			method.invoke(connectivityManager, on);
			return 0;
		} catch (NoSuchMethodException e) {
			e.printStackTrace();
			return -1;
		} catch (Exception e) {
			e.printStackTrace();
			return -2;
		}
	} 

	/* WIFI */
	private int toggleWiFi(Context context, boolean status) {
		try {
			WifiManager wifiManager = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);
			if (status == true && !wifiManager.isWifiEnabled()) {
				wifiManager.setWifiEnabled(true);
			} else if (status == false && wifiManager.isWifiEnabled()) {
				wifiManager.setWifiEnabled(false);
			}
			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* bluetooth */
	private int togglebluetooth(Context context, boolean status) {
		try {
			BluetoothAdapter adapter = BluetoothAdapter.getDefaultAdapter(); 
			if (status == true){
				adapter.enable();
			} else {
				adapter.disable();
			}
			return 0;
		} catch (Exception e) {
			return -1;
		}
	}

	/* toast */
	private void toast_print(Context context, String get_text){
		Toast t = null;
		if(t == null) {
			t = Toast.makeText(context, get_text, Toast.LENGTH_SHORT);
		}
		t.show();
	}

	private int ismobile(Context context) { // network 연결 상태 확인
		try {
			ConnectivityManager manager = (ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);

			// mobile ConnectivityManager.TYPE_MOBILE
			State mobile = manager.getNetworkInfo(0).getState(); 

			if (!(mobile == NetworkInfo.State.DISCONNECTED || mobile == NetworkInfo.State.DISCONNECTING)) {
				return 1;
			}
		} catch (NullPointerException e) {
			return -1;
		}
		return 0;
	}

	@SuppressWarnings("unused")
	private int iswifi(Context context) { // network 연결 상태 확인
		try {
			ConnectivityManager conMan = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);

			// wifi
			State wifi = conMan.getNetworkInfo(1).getState(); 

			if (!(wifi == NetworkInfo.State.DISCONNECTED || wifi == NetworkInfo.State.DISCONNECTING)) {
				return 1;
			}	
		} catch (NullPointerException e) {
			return -1;
		}
		return 0;
	}

}

